
<!DOCTYPE html>
<html lang="it">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Fabbisogni - IMAX</title>
  <style>
    body {
      margin: 0;
      font-family: 'Segoe UI', sans-serif;
      background-color: #121212;
      color: white;
      padding: 20px;
    }
    h2 {
      margin-bottom: 10px;
    }
    button {
      background-color: #444;
      color: white;
      border: none;
      padding: 10px 20px;
      cursor: pointer;
    }
    button:hover {
      background-color: #666;
    }
    table {
      width: 100%;
      border-collapse: collapse;
      margin-top: 20px;
    }
    th, td {
      border: 1px solid #999;
      padding: 8px;
      text-align: left;
    }
    th {
      background-color: #222;
    }
  </style>
</head>
<body>
  <h2>Fabbisogni</h2>
  <button onclick="caricaFabbisogni()">ðŸ”„ Carica dati</button>
  <div id="tabella-fabbisogni"></div>

  <script>
    async function caricaFabbisogni() {
      const fabbAccURL = 'https://opensheet.elk.sh/1gdjtzT0NUvta_71xzHJMVvupgF2lPgKT/FabbAcc';
      const ordiniURL = 'https://opensheet.elk.sh/1wNinpO63Uh85vD0fw2sgwq54FzeFdJGA1rmobVAK6cc/Ordini';
      const fabbData = await fetch(fabbAccURL).then(r => r.json());
      const ordiniData = await fetch(ordiniURL).then(r => r.json());

      const ordiniPerArticolo = {};
      for (const o of ordiniData) {
        const key = o.idart;
        if (!ordiniPerArticolo[key]) ordiniPerArticolo[key] = { AI: 0, PE: 0 };
        if (o.stag.startsWith("AI")) ordiniPerArticolo[key].AI += parseInt(o.qord);
        if (o.stag.startsWith("PE")) ordiniPerArticolo[key].PE += parseInt(o.qord);
      }

      let html = `<table><tr><th>ID Articolo</th><th>Descrizione</th><th>Ord AI</th><th>Ord PE</th></tr>`;
      for (const r of fabbData) {
        const id = r.ID;
        const ord = ordiniPerArticolo[id] || { AI: 0, PE: 0 };
        html += `<tr><td>${id}</td><td>${r.Descrizione}</td><td>${ord.AI}</td><td>${ord.PE}</td></tr>`;
      }
      html += `</table>`;
      document.getElementById("tabella-fabbisogni").innerHTML = html;
    }
  </script>
</body>
</html>
